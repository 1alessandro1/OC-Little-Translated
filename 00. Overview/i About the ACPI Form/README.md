# ACPI Form

## Brief description

ACPI (Advanced Configuration & Power Interface) is an advanced computer configuration and power interface, which is a power management standard developed by Intel, Microsoft and other manufacturers, namely [`ACPI specification`](https://www.acpica.org/documentation). Each computer is shipped with a set of binary files that conform to the ACPI specification, which we call ACPI forms. The number and content of ACPI forms varies from machine to machine and **may** vary with BIOS version. 

**ACPI forms include:**

* `DSDT.aml`
* Multiple SSDT-xxxx.aml, such as: `SSDT-SataAhci.aml`, `SSDT-CpuSsdt.aml`, `SSDT-CB-01.aml`, etc.
- Other .aml such as: `APIC.aml`, `BGRT.aml`, `DMAR.aml`, `ECDT.aml`, etc.

Some tools and Bootloaders can extract the machine's ACPI Form, like Aida64 under Windows, Bootloaders like OpenCore and Clover, etc. in macOS. Because ACPI forms are binary files, we need a decompiler to help us read the contents, such as `MaciASL` for macOS systems. When opening these forms with decompiler software, especially when opening `DSDT.aml`, many errors may occur. It is important to note that in most cases these errors are generated by the software decompilation process and are not present in the ACPI forms provided by the machine.

The ACPI Form describes the machine's hardware information in `.aml` format and does not have any driver capabilities of its own. However, the correct ACPI is required for a piece of hardware to work properly, and the wrong way of describing it can lead to boot failures or system crashes. For example, if the machine has a Broadcom NIC plugged in, but in the ACPI it's described as an Intel NIC, the system will load the Intel NIC driver, which is obviously wrong. Another example is that the machine does not provide `auto-adjust brightness` hardware, even if the ACPI adds `SSDT-ALS0`, the brightness can not be adjusted automatically.

Because the working principles of Windows and macOS are different, Hackintoshes requires fixes for the ACPI. Correct ACPI is the foundation of stable working Hackintosh. **Hotpatching** is highly recommended to patch the ACPI. Hotpatches can be a good way to avoid the so-called DSDT errors.

For more details about ACPI, please see [`ACPI Specification`](https://www.acpica.org/documentation); for an introduction to the aml language, please refer to "ASL Syntax Basics".

### ACPI patches
This chapter `ACPI Patches` only applies to `OpenCore`

- DSDT Patches and SSDT Patches. Refer to other chapters in OC-little for this section.

Other Form Patches:

- **Clear ACPI `header fields`** 
  - **Patch method**: `ACPI\Quirks\NormalizeHeaders` = `true` 
    - **Note**: Only Mac 10.13 needs this patch
- **Relocate ACPI memory regions** 
    - **Patch method**: `ACPI\Quirks\RebaseRegions` = `true` 
    - **Description**: ACPI forms have memory regions with both dynamically allocated addresses and fixed addresses. The patch serves to **Rebase ACPI memory regions** , an operation that is very dangerous and should not be chosen unless this patch solves the boot crash problem.
- **FACP.aml** 
  - **Patch method**: `ACPI\Quirks\FadtEnableReset` = `true` 
  - **Description**: [`ACPI Specification`](https://www.acpica.org/documentation) defines various static system information related to configuration and power management in terms of **FADT**, which appears as the **FACP.aml** form in the machine's ACPI form. The **FACP.aml** form characterizes information such as the RTC clock, power and sleep buttons, power management, etc. Currently related to Black Apple are the following.
 - If you press the **Power Button** and cannot call out the "Restart, Sleep, Cancel, Shutdown" menu, try using this patch.
**Note**: If `ACPI\Quirks\FadtEnableReset` = `true` still can't call out the "Restart, Sleep, Cancel, Shutdown" menu, try adding ***SSDT-PMCR***. ***SSDT-PMCR*** is located in OC-little's Adding Missing Parts.
 - The `Low Power S0 Idle`, `Hardware Reduced` of the **FACP.aml** form characterizes the machine type and determines the power management method. If `Low Power S0 Idle` = `1`, the machine is an `AOAC`. See About AOAC for more information on `AOAC`.
    
  - **FACS.aml** 
    - **Patch method**: `ACPI\Quirks\ResetHwSig` = `true` 
    - **Note**: The `Hardware Signature` item of the **FACS.aml** form is a 4-byte hardware signature, which is calculated after the system boots based on the base hardware configuration. If this value is changed after the machine wakes up from the **Hibernate** state **the system will not recover correctly. The patch works by making `Hardware Signature` = `0` to try to resolve the above issue.
    - **Note: **If the system has **Hibernation** disabled, you do not need to bother with this patch!
  - **BGRT.aml** 
    - **Patch method**: `ACPI\Quirks\ResetLogoStatus` = `true` 
    - **Description**: **BGRT.aml** form is the bootstrap graphics resource table. According to the [`ACPI specification`](https://www.acpica.org/documentation), the `Displayed` item of the form should = `0`. However, some vendors have written non-zero data to the `Displayed` entry for some reason, which may cause the screen refresh to fail during the boot phase. The patch works to make `Displayed` = `0`.
    - **Note: **Not all machines have this form
  - **DMAR.aml** 
    - **Patch method**: `Kernel\Quirks\DisableIoMapper` = `true` 
    - **Note**: The patch works the same as BIOS disable `VT-d` or Drop **DMAR.aml** 
    - **Note**: Only early Mac systems need this patch
  - **ECDT.aml** 
    - **Patch Method**: Global rename to make the `EC` name, path and `Namepath` of all ACPI forms identical
    - **Note**: Individual machines (e.g. **Lenovo yoga-s740**) have `Namepath` in the **ECDT.aml** form that is inconsistent with the `EC` name of other ACPI forms, which can cause ACPI errors during the boot process. This patch is a good solution to the ACPI error problem.
    - **Note**: Not all machines have this form
